name: ðŸš€ Release Drafter
on:
  pull_request:
    types:
      - closed

jobs:
  release-drafter:
    name: Release Drafter
    if: github.event.pull_request.merged == true && github.base_ref == 'main'

    runs-on: ubuntu-latest

    permissions:
      contents: write
      pull-requests: read

    steps:
      - name: Draft release notes - ${{ github.head_ref }}
        if: ${{ ! startsWith(github.head_ref, 'release/v') }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        uses: release-drafter/release-drafter@v6.0.0
        with:
          config-name: release-drafter-config.yml

      - name: Set env
        if: ${{ startsWith(github.head_ref, 'release/v') }}
        run: |
          echo "RELEASE_VERSION=$(sed 's/release\/v//' <<< ${{ github.head_ref }})" >> "$GITHUB_ENV"

      - name: Draft release notes - ${{ github.head_ref }}
        if: ${{ startsWith(github.head_ref, 'release/v') }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        uses: release-drafter/release-drafter@v6.0.0
        with:
          config-name: release-drafter-config.yml
          version: ${{ env.RELEASE_VERSION }}
